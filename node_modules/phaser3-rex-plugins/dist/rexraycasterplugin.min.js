var e,t;e=void 0,t=function(){const e=Phaser.GameObjects.GameObject;var t=function(e){return void 0!==e.displayWidth?e.displayWidth:e.width},s=function(e){return void 0!==e.displayHeight?e.displayHeight:e.height};Phaser.Geom.Rectangle;const r=Phaser.Math.Vector2,n=Phaser.Math.RotateAround;Phaser.GameObjects.Container;var o=void 0,i=function(e,t,s){return void 0===s&&(s=!1),0!==e.rotation&&n(t,e.x,e.y,e.rotation),s&&e.parentContainer&&e.parentContainer.getBoundsTransformMatrix().transformPoint(t.x,t.y,t),t};const a=Phaser.Geom.Polygon;var h=function(e,n){void 0===n&&(n=new a);var h=function(e,n,a){return void 0===n?n=new r:!0===n&&(void 0===o&&(o=new r),n=o),e.getTopLeft?e.getTopLeft(n):(n.x=e.x-t(e)*e.originX,n.y=e.y-s(e)*e.originY,i(e,n,a))}(e),l=function(e,n,a){return void 0===n?n=new r:!0===n&&(void 0===o&&(o=new r),n=o),e.getTopRight?e.getTopRight(n):(n.x=e.x-t(e)*e.originX+t(e),n.y=e.y-s(e)*e.originY,i(e,n,a))}(e),c=function(e,n,a){return void 0===n?n=new r:!0===n&&(void 0===o&&(o=new r),n=o),e.getBottomRight?e.getBottomRight(n):(n.x=e.x-t(e)*e.originX+t(e),n.y=e.y-s(e)*e.originY+s(e),i(e,n,a))}(e),y=function(e,n,a){return void 0===n?n=new r:!0===n&&(void 0===o&&(o=new r),n=o),e.getBottomLeft?e.getBottomLeft(n):(n.x=e.x-t(e)*e.originX,n.y=e.y-s(e)*e.originY+s(e),i(e,n,a))}(e);return n.setTo([h,l,c,y,h]),n};const l=Phaser.Geom.Polygon,c=Phaser.Utils.Array.SpliceOne;class y{constructor(){this.gameObjects=[],this.polygons=[]}contains(e){return-1!==this.gameObjects.indexOf(e)}get(e){return g.gameObject=this.gameObjects[e],g.polygon=this.polygons[e],g}addDestroyCallback(e){if(Array.isArray(e)){for(var t=e,s=0,r=t.length;s<r;s++)this.addDestroyCallback(t[s]);return this}return e.on&&e.once("destroy",this.onChildDestroy,this),this}removeDestroyCallback(e){if(Array.isArray(e)){for(var t=e,s=0,r=t.length;s<r;s++)this.removeDestroyCallback(t[s]);return this}return e.off&&e.off("destroy",this.onChildDestroy,this),this}clear(){return this.removeDestroyCallback(this.gameObjects),this.gameObjects.length=0,this.polygons.length=0,this}add(t,s){return this.contains(t)||(t instanceof e?void 0===s&&(s=h(t)):t instanceof l&&(s=t),this.gameObjects.push(t),this.polygons.push(s),this.addDestroyCallback(t)),this}remove(e){var t=this.gameObjects.indexOf(e);return-1===t||(c(this.gameObjects,t),c(this.polygons,t),this.removeDestroyCallback(e)),this}onChildDestroy(e,t){this.remove(e)}update(e,t){var s=this.gameObjects.indexOf(e);return-1===s||(void 0===t&&(t=h(e,this.polygons[s])),this.polygons[s]=t),this}}var g={};const u=Phaser.Geom.Intersects.GetLineToLine,d=Phaser.Geom.Intersects.PointToLine;var f=function(e,t,s){void 0===s?s={}:!0===s&&(s=v);var r=!1;m.setTo(e.x1,e.y1),s.d=1/0,p.set();for(var n=t[0],o=1;o<t.length;o++){var i=t[o];b.setTo(n.x,n.y,i.x,i.y),n=i,d(m,b)||u(e,b,!1,p)&&p.z<s.d&&(s.x=p.x,s.y=p.y,s.d=p.z,s.segIndex=o-1,r=!0)}return r?s:null},v={},m=new Phaser.Geom.Point,b=new Phaser.Geom.Line,p=new Phaser.Math.Vector3,x=function(e,t){var s=Array.isArray(e);if(void 0===t?t=s?[]:{}:function(e){if("object"!=typeof e||null===e)return e;if(Array.isArray(e))e.length=0;else for(var t in e)delete e[t]}(t),s){t.length=e.length;for(var r=0,n=e.length;r<n;r++)t[r]=e[r]}else for(var o in e)t[o]=e[o];return t};const P=Phaser.Geom.Polygon.GetAABB,O=Phaser.Geom.Intersects.LineToRectangle;var A={},j=new Phaser.Geom.Rectangle;const w=Phaser.Utils.Objects.GetValue,G=Phaser.Geom.Line,T=Phaser.Geom.Line.SetToAngle,L=Phaser.Geom.Line.ReflectAngle;class R{constructor(e){this.obstacles=new y,this.ray=new G,this.setMaxRayLength(w(e,"maxRayLength",1e4)),this.result={hit:!1,x:0,y:0,segment:new G,polygon:null,gameObject:null,reflectAngle:0}}destroy(){this.obstacles.clear(),this.obstacles=null,this.ray=null,this.result=null}setMaxRayLength(e){return this.maxRayLength=e,this}addObstacle(e,t){if(Array.isArray(e))for(var s=e,r=0,n=s.length;r<n;r++)this.obstacles.add(s[r]);else this.obstacles.add(e,t);return this}clearObstacle(){return this.obstacles.clear(),this}removeObstacle(e){if(Array.isArray(e))for(var t=e,s=0,r=t.length;s<r;s++)this.obstacles.remove(t[s]);else this.obstacles.remove(e);return this}updateObstacle(e,t){if(Array.isArray(e))for(var s=e,r=0,n=s.length;r<n;r++)this.obstacles.update(s[r]);else this.obstacles.update(e,t);return this}hitTest(){var e=function(e,t,s){void 0===s?s={}:!0===s&&(s=A),Array.isArray(t)||(t=[t]);var r=!1;s.d=1/0;for(var n=0;n<t.length;n++){var o=t[n];if(!(o.points.length>9)||O(e,P(o,j))){var i=f(e,o.points,!0);i&&i.d<s.d&&(x(i,s),s.shapeIndex=n,r=!0)}}return r?s:null}(this.ray,this.obstacles.polygons,!0);if(e){this.ray.x2=e.x,this.ray.y2=e.y,this.result.hit=!0,this.result.x=e.x,this.result.y=e.y;var t=this.obstacles.get(e.shapeIndex);this.result.polygon=t.polygon,this.result.gameObject=t.gameObject;var s=this.result.polygon.points,r=e.segIndex,n=s[r],o=s[r+1],i=this.result.segment;i.setTo(n.x,n.y,o.x,o.y),this.result.reflectAngle=L(this.ray,i)}else this.result.hit=!1;return!!e&&this.result}rayToward(e,t,s){return T(this.ray,e,t,s,this.maxRayLength),this.hitTest()}}class C extends Phaser.Plugins.BasePlugin{constructor(e){super(e)}start(){this.game.events.on("destroy",this.destroy,this)}add(e){return new R(e)}}return C},"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).rexraycasterplugin=t();
